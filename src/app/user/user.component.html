<div class="container">
  <div class="crud-list">
    <h1>Usuarios</h1>

    <button class="btn btn-info" type="button" data-toggle="modal" data-target="#userForm" (click)="onSelectNew()">
      Crear Usuario
    </button>
    
    <div class="input-group">
      <input type="text" class="form-control" placeholder="Nombre de usuario" 
        id="searchBox" name="searchBox" #searchBox (keyup.enter)="search(searchBox.value)"/>
      <div class="input-group-addon">
        <button (click)="search(searchBox.value)"><i class="fa fa-search" aria-hidden="true"></i></button>
      </div>
    </div>
    
    <div *ngIf="userList && userList.length > 0">
      <div *ngFor="let user of userList" class="patient-box">
        <p>
          Usuario: {{user.username}} - {{user.firstname}} {{user.lastname}} - {{user.authority.name}} - {{user.company.name}}
        </p>
      
        <button class="btn btn-info btn-xs" type="button" data-toggle="modal" data-target="#userForm"
          (click)="onSelectDetail(user)" title="Editar">
            <i class="fa fa-pencil" aria-hidden="true"></i>
        </button>
        <button class="btn btn-info btn-xs" type="button" data-toggle="modal" data-target="#passwordForm"
          (click)="onSelectPassword(user)" title="Cambiar Clave">
            <i class="fa fa-key" aria-hidden="true"></i>
        </button>
        <button class="btn btn-danger btn-xs" type="button" data-toggle="modal" data-target="#deluserForm"
          (click)="onSelectDelete(user)" title="Eliminar">
            <i class="fa fa-trash" aria-hidden="true"></i>
        </button>

      </div>
    </div>
  </div>
</div>

<!-- User form -->
<div class="modal fade" id="userForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" *ngIf="selectedUser">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel">Detalles del Usuario</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <form>

          <div class="form-group">
            <label for="username">Usuario</label>
            <input type="text"  [disabled]="editMode" class="form-control" placeholder="Nombre de usuario" id="username" 
              name="username" required [(ngModel)]="selectedUser.username">
          </div>
          <div class="form-group" *ngIf="!editMode">
            <label for="password">Contraseña</label>
            <input type="password" class="form-control" placeholder="Contraseña" id="password" 
              name="password" required [(ngModel)]="selectedUser.password">
          </div>
          <div class="form-group">
            <label for="name">Nombre</label>
            <input type="text" class="form-control" placeholder="Nombre" id="name" 
              name="name" required [(ngModel)]="selectedUser.firstname">
          </div>
          <div class="form-group">
            <label for="lastname">Apellido</label>
            <input type="text" class="form-control" placeholder="Apellido" id="lastname" 
              name="lastname" required [(ngModel)]="selectedUser.lastname">
          </div>
          <div class="form-group">
            <label for="email">Correo</label>
            <input type="email" class="form-control" placeholder="Correo Electrónico" id="email" 
              name="email" required [(ngModel)]="selectedUser.email">
          </div>
          <div class="form-group" *ngIf="auth.isAuthenticated() && auth.isCurrentUserRoot()">
            <label for="enabled">Habilitado</label>
            <select class="form-control" id="enabled" name="enabled" [(ngModel)]="selectedUser.enabled">
              <option value="1">Habilitado</option>
              <option value="0">Deshabilitado</option>
            </select>
          </div>
          <div class="form-group" *ngIf="auth.isAuthenticated() && auth.isCurrentUserRoot()">
            <label for="rol">Rol</label>
            <select class="form-control" id="rol" name="rol" [(ngModel)]="selectedUser.authority.name">
              <option value="ROLE_ROOT">Root</option>
              <option value="ROLE_ADMIN">Administrador</option>
              <option value="ROLE_OPERATOR">Operador</option>
            </select>
          </div>
          <div class="form-group" *ngIf="auth.isAuthenticated() && auth.isCurrentUserRoot()">
            <label for="company">Empresa</label>
            <select class="form-control" id="company" name="company" [(ngModel)]="selectedUser.company.id">
              <option *ngFor="let comp of companyList" value="{{comp.id}}">{{comp.name}}</option>
            </select>
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-info" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-info" data-dismiss="modal" (click)="onSave()">Guardar</button>
      </div>
    </div>
  </div>
</div>

<!-- Password form -->
<div class="modal fade" id="passwordForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" *ngIf="selectedUser">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel">Cambiar Clave de Usuario</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <form>

          <div class="form-group">
            <label for="password">Contraseña</label>
            <input type="password" class="form-control" placeholder="Contraseña" id="password" 
              name="password" required [(ngModel)]="selectedUser.password">
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-info" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-info" data-dismiss="modal" (click)="onChangePass()">Guardar</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete User form -->
<div class="modal fade" id="deluserForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" *ngIf="selectedUser">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel">Eliminar Usuario</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <p>
          ¿Está seguro que quiere eliminar el usuario?
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-info" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="onDelete()">Eliminar</button>
      </div>
    </div>
  </div>
</div>